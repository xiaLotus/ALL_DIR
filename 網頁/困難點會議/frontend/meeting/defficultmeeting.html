<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>困難點會議紀錄</title>
    <script src="../static/js/package/tailwinds.js"></script>
    <script src="../static/js/package/vue.global.js"></script>
    <script src="../static/js/package/axios.min.js"></script>
    <script src="../static/js/package/lucide.js"></script>
    <script src="../static/js/package/sweetalert2@11.js"></script>
    <script src="../static/js/package/xlsx.min.js"></script>


    <style>
        html, body {
            height: 100%;
            margin: 0;
            /* overflow: hidden; */
        }
        
        /* 動畫效果 */
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            animation: slideUp 0.3s ease-out;
        }
        
        .modal-backdrop {
            animation: fadeIn 0.2s ease-out;
        }
        
        /* 浮動按鈕動畫 */
        @keyframes pulse-ring {
            0% {
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
            }
            100% {
                box-shadow: 0 0 0 20px rgba(34, 197, 94, 0);
            }
        }
        
        .floating-button {
            animation: pulse-ring 2.5s infinite;
        }
        
        @keyframes pulse-ring {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.3);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }

        /* 新增按鈕的綠色脈動 */
        .floating-button:last-child {
            animation: pulse-ring-green 2.5s infinite 1.2s;
        }

        @keyframes pulse-ring-green {
            0% {
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.3);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(34, 197, 94, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
            }
        }

        /* 懸停時停止脈動動畫 */
        .floating-button:hover {
            animation: none;
        }

        /* 響應式調整 */
        @media (max-width: 768px) {
            .floating-button {
                width: 56px;
                height: 56px;
            }
            
            .floating-button i {
                width: 28px;
                height: 28px;
            }
        }
        

        /* 自定義滾動條 */
        /* 平滑滾動和加粗深藍色滾動軸 */
        .custom-scrollbar {
            /* 平滑滾動行為 */
            scroll-behavior: smooth;
            /* 優化滾動性能 */
            -webkit-overflow-scrolling: touch;
            /* 硬體加速 */
            transform: translateZ(0);
            will-change: scroll-position;
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 14px; /* 加粗滾動條寬度 */
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: linear-gradient(to bottom, #f1f5f9, #e2e8f0);
            border-radius: 14px;
            border: 2px solid #cbd5e1;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #1e3a8a, #1e40af);
            border-radius: 14px;
            border: 3px solid #f8fafc;
            box-shadow: 0 3px 8px rgba(30, 58, 138, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* 更平滑的過渡效果 */
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, #1e40af, #1d4ed8);
            box-shadow: 0 5px 12px rgba(30, 58, 138, 0.5);
            transform: scale(1.05);
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:active {
            background: linear-gradient(to bottom, #1d4ed8, #2563eb);
            box-shadow: 0 3px 6px rgba(30, 58, 138, 0.6);
        }
        
        /* 表格行的平滑過渡效果 */
        .custom-scrollbar tbody tr {
            transition: all 0.2s ease-in-out;
        }
        
        /* 滾動容器的優化 */
        .scroll-container {
            scroll-behavior: smooth;
            scrollbar-width: auto;
            scrollbar-color: #1e3a8a #f1f5f9;
        }
        
        /* 輸入框聚焦效果 */
        .input-focus {
            transition: all 0.2s ease;
        }
        
        .input-focus:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* 多選下拉選單樣式 */
        .dropdown-item {
            transition: all 0.15s ease;
        }
        
        .dropdown-item:hover {
            padding-left: 12px;
        }
        
        /* 標籤樣式 */
        .tag {
            animation: fadeIn 0.2s ease;
        }

        /* 滾動狀態 Toast 彈窗 - 左側版本 */
        .scroll-toast {
            position: fixed;
            left: 20px;
            bottom: 20px;  /* 改為底部左側 */
            background: rgba(59, 130, 246, 0.9);
            color: white;
            padding: 8px 12px;  /* 縮小內邊距 */
            border-radius: 8px;  /* 縮小圓角 */
            font-size: 12px;  /* 縮小字體 */
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            z-index: 9999;
            transform: translateX(-100%);
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;  /* 縮小間距 */
            min-width: 80px;  /* 縮小最小寬度 */
        }

        
        .scroll-toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .scroll-toast .icon {
            width: 12px;  /* 縮小圖標 */
            height: 12px;
            animation: spin 1s linear infinite;
        }

        
        .scroll-toast.completed .icon {
            animation: none;
        }
                
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* 滾動完成時的綠色樣式 */
        .scroll-toast.completed {
            background: linear-gradient(135deg, #059669, #10b981);
            box-shadow: 0 8px 25px rgba(5, 150, 105, 0.3);
        }
        
        /* 滾動進度條 */
        .scroll-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 0 0 12px 12px;
            transition: width 0.1s ease;
        }

        /* 響應式調整 */
        @media (max-width: 768px) {
            .scroll-toast {
                left: 10px;
                padding: 6px 10px;
                font-size: 11px;
                min-width: 70px;
            }
            
            .scroll-toast .icon {
                width: 10px;
                height: 10px;
            }
        }

        /* 可選：深色主題版本 */
        .scroll-toast.dark-theme {
            background: linear-gradient(135deg, #1f2937, #374151);
            border: 1px solid rgba(75, 85, 99, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        /* 可選：成功狀態 */
        .scroll-toast.success {
            background: linear-gradient(135deg, #059669, #10b981);
            box-shadow: 0 8px 25px rgba(5, 150, 105, 0.3);
        }

        .scroll-toast.success .scroll-progress {
            background: rgba(255, 255, 255, 0.4);
        }

        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.2s;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        /* 在你的 <style> 區塊中添加這個類別 */
        .select-text {
            user-select: text !important;
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
        }

        .loader {
            width: 48px;
            height: 48px;
            margin: auto;
            position: relative;
        }
        .loader:before {
            content: '';
            width: 48px;
            height: 5px;
            background: #f0808050;
            position: absolute;
            top: 60px;
            left: 0;
            border-radius: 50%;
            animation: shadow324 0.5s linear infinite;
        }
        .loader:after {
            content: '';
            width: 100%;
            height: 100%;
            background: #f08080;
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 4px;
            animation: jump7456 0.5s linear infinite;
        }
        @keyframes jump7456 {
            15% { border-bottom-right-radius: 3px; }
            25% { transform: translateY(9px) rotate(22.5deg); }
            50% { transform: translateY(18px) scale(1, .9) rotate(45deg); border-bottom-right-radius: 40px; }
            75% { transform: translateY(9px) rotate(67.5deg); }
            100% { transform: translateY(0) rotate(90deg); }
        }
        @keyframes shadow324 {
            0%, 100% { transform: scale(1, 1); }
            50% { transform: scale(1.2, 1); }
        }
        /* 增強現有的 scroll-toast */
        .scroll-toast {
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 25px rgba(59, 130, 246, 0.25),
                0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .scroll-toast .icon {
            filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.4));
        }

        .scroll-toast .scroll-progress {
            box-shadow: 0 0 6px rgba(255, 255, 255, 0.4);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-50 to-gray-100 font-sans leading-normal tracking-normal">
    <div id="app" class="mx-auto relative">


<!-- 上方區塊 (header, 滿版寬度) -->
        <div class="relative bg-white shadow-lg p-4 lg:p-6 w-full border-b border-gray-200">
            <!-- 左上角訊息 - 始終顯示 -->
            <div class="absolute top-4 left-4 lg:left-6 flex items-center gap-2 bg-gradient-to-r from-amber-50 to-orange-50 text-amber-800 text-sm font-medium px-3 lg:px-4 py-2 rounded-full shadow-sm border border-amber-200">
                <i data-lucide="user" class="w-4 h-4"></i>
                <!-- 小螢幕顯示簡短版本，大螢幕顯示完整版本 -->
                <span class="hidden sm:inline">{{ message }}</span>
                <span class="sm:hidden">{{ message.split(' ')[2] || 'K18251' }}</span>
            </div>
            
            <!-- 右上角按鈕群 -->
            <div class="absolute top-4 right-4 lg:right-6">
                
                <!-- 小螢幕漢堡選單 (lg以下顯示) -->
                <div class="lg:hidden relative">
                    <button @click="showMobileMenu = !showMobileMenu" 
                        class="w-10 h-10 bg-white border border-gray-300 hover:bg-gray-50 rounded-lg flex items-center justify-center transition-all duration-200 shadow-md relative"
                        :class="showMobileMenu ? 'bg-blue-500 border-blue-500 text-white hover:bg-blue-600' : 'text-gray-700'">
                        <i :data-lucide="showMobileMenu ? 'x' : 'menu'" class="w-5 h-5"></i>
                        <!-- 如果有隱藏欄位，顯示小紅點 -->
                        <span v-if="hiddenColumnsCount > 0" 
                            class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
                    </button>
                    
                    <!-- 下拉選單 -->
                    <transition 
                        enter-active-class="transition ease-out duration-200"
                        enter-from-class="opacity-0 scale-95"
                        enter-to-class="opacity-100 scale-100"
                        leave-active-class="transition ease-in duration-150"
                        leave-from-class="opacity-100 scale-100"
                        leave-to-class="opacity-0 scale-95">
                        <div v-if="showMobileMenu" 
                            class="absolute top-full right-0 mt-2 bg-white border border-gray-300 rounded-xl shadow-xl z-[100] w-52 py-3 overflow-hidden">
                            
                            <!-- 清除篩選 -->
                            <button @click.stop="clearAllFilters(); showMobileMenu = false" 
                                class="w-full text-left px-4 py-3 hover:bg-yellow-50 flex items-center gap-3 text-gray-700 transition-colors group">
                                <div class="w-9 h-9 bg-gradient-to-r from-yellow-400 to-yellow-500 rounded-xl flex items-center justify-center group-hover:scale-105 transition-transform shadow-md">
                                    <i data-lucide="trash-2" class="w-4 h-4 text-white"></i>
                                </div>
                                <div>
                                    <div class="font-medium">清除篩選</div>
                                    <div class="text-xs text-gray-500">移除所有篩選條件</div>
                                </div>
                            </button>
                            <!-- 欄位設定 -->
                            <button @click.stop="showMobileColumnSettings = true; showMobileMenu = false" 
                                class="w-full text-left px-4 py-3 hover:bg-blue-50 flex items-center gap-3 text-gray-700 transition-colors group">
                                <div class="w-9 h-9 bg-gradient-to-r from-blue-400 to-blue-500 rounded-xl flex items-center justify-center group-hover:scale-105 transition-transform shadow-md relative">
                                    <i data-lucide="settings" class="w-4 h-4 text-white"></i>
                                    <span v-if="hiddenColumnsCount > 0" 
                                        class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold shadow-sm">
                                        {{ hiddenColumnsCount }}
                                    </span>
                                </div>
                                <div>
                                    <div class="font-medium">欄位設定</div>
                                    <div class="text-xs text-gray-500">
                                        <span v-if="hiddenColumnsCount > 0">{{ hiddenColumnsCount }} 個欄位已隱藏</span>
                                        <span v-else>管理表格欄位顯示</span>
                                    </div>
                                </div>
                            </button>
                            
                            <!-- 分隔線 -->
                            <!-- <div class="border-t border-gray-200 mx-4 my-2"></div> -->
                            <!-- 查閱圖表 -->
                            <button @click.stop="goDataChart(); showMobileMenu = false"
                                class="w-full text-left px-4 py-3 hover:bg-purple-50 flex items-center gap-3 text-gray-700 transition-colors group">
                                <div class="w-9 h-9 bg-gradient-to-r from-purple-500 to-indigo-500 rounded-xl flex items-center justify-center group-hover:scale-105 transition-transform shadow-md">
                                    <i data-lucide="bar-chart-3" class="w-4 h-4 text-white"></i>
                                </div>
                                <div>
                                    <div class="font-medium">查閱圖表</div>
                                    <div class="text-xs text-gray-500">查看每週統計與趨勢</div>
                                </div>
                            </button>

                            <!-- 登出 -->
                            <button @click.stop="logout(); showMobileMenu = false" 
                                class="w-full text-left px-4 py-3 hover:bg-red-50 flex items-center gap-3 text-red-600 transition-colors group">
                                <div class="w-9 h-9 bg-gradient-to-r from-red-500 to-red-600 rounded-xl flex items-center justify-center group-hover:scale-105 transition-transform shadow-md">
                                    <i data-lucide="log-out" class="w-4 h-4 text-white"></i>
                                </div>
                                <div>
                                    <div class="font-medium">登出</div>
                                    <div class="text-xs text-red-400">結束目前會話</div>
                                </div>
                            </button>
                        </div>
                    </transition>
                </div>
                
        <!-- 小螢幕選單背景遮罩 (在 header 外層) -->
        <div v-if="showMobileMenu" 
             class="lg:hidden fixed inset-0 bg-black/30 backdrop-blur-sm z-[90]"
             @click="showMobileMenu = false">
        </div>
                
                <!-- 大螢幕按鈕群 (lg以上顯示) -->
                <div class="hidden lg:flex items-center gap-3">
                    <!-- 清除所有篩選條件按鈕 -->
                    <button @click="clearAllFilters"
                        class="flex items-center gap-2 bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-white font-medium px-4 py-2 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg group">
                        <i data-lucide="filter-x" class="w-4 h-4 group-hover:scale-110 transition-transform"></i>
                        <span>清除篩選</span>
                    </button>

                    <!-- 欄位設定按鈕 -->
                    <div class="relative" ref="columnSettingsWrapper">
                        <button @click="toggleColumnSettings" 
                            :class="['flex items-center gap-2 font-medium px-4 py-2 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg relative',
                                     showColumnSettings ? 'bg-blue-500 text-white' : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50']">
                            <i data-lucide="columns" class="w-4 h-4"></i>
                            <span>欄位設定</span>
                            <span v-if="hiddenColumnsCount > 0" 
                                class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                {{ hiddenColumnsCount }}
                            </span>
                        </button>
                        
                        <!-- 欄位設定下拉面板 -->
                        <transition name="fade">
                            <div v-if="showColumnSettings"
                                class="absolute top-full right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-64 p-4 space-y-3">
                                
                                <!-- 標題與控制按鈕 -->
                                <div class="flex justify-between items-center">
                                    <h3 class="text-sm font-bold text-gray-800">欄位顯示設定</h3>
                                    <div class="flex gap-2">
                                        <button @click="selectAllColumns"
                                            class="text-xs text-green-600 hover:text-green-700 font-medium transition">
                                            全選
                                        </button>
                                        <span class="text-gray-300">|</span>
                                        <button @click="resetColumnVisibility"
                                            class="text-xs text-blue-600 hover:text-blue-700 font-medium transition">
                                            預設
                                        </button>
                                    </div>
                                </div>
                                <hr class="border-gray-200" />
                                
                                <!-- 欄位列表 -->
                                <div class="max-h-80 overflow-y-auto space-y-2">
                                    <label v-for="(visible, columnName) in columnVisibility" 
                                        :key="columnName"
                                        class="flex items-center gap-3 cursor-pointer hover:bg-gray-50 px-2 py-1.5 rounded transition">
                                        <input type="checkbox" 
                                            :checked="visible" 
                                            @change="toggleColumnVisibility(columnName)"
                                            class="text-blue-600 focus:ring-blue-500 rounded">
                                        <span class="text-sm text-gray-700 flex-1">{{ columnName }}</span>
                                        <span v-if="!visible" class="text-xs text-red-500 font-medium">隱藏</span>
                                    </label>
                                </div>
                                
                                <!-- 統計資訊 -->
                                <div class="text-xs text-gray-500 text-center pt-2 border-t border-gray-200">
                                    顯示 {{ visibleColumns.length }} / {{ Object.keys(columnVisibility).length }} 個欄位
                                </div>
                            </div>
                        </transition>
                    </div>
                    <!-- 查閱圖表 -->
                    <button @click="goDataChart"
                        class="flex items-center gap-2 bg-gradient-to-r from-purple-500 to-indigo-500 
                            hover:from-purple-600 hover:to-indigo-600 text-white font-medium 
                            px-4 py-2 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg group">
                        <i data-lucide="bar-chart-3" class="w-4 h-4 group-hover:scale-110 transition-transform"></i>
                        <span>查閱圖表</span>
                    </button>
                    
                    <!-- 登出按鈕 -->
                    <button @click="logout" 
                        class="flex items-center gap-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-medium px-4 py-2 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg group">
                        <i data-lucide="log-out" class="w-4 h-4 group-hover:scale-110 transition-transform"></i>
                        <span>登出</span>
                    </button>
                </div>
            </div>
            
            <!-- 置中標題 -->
            <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-gray-700 to-gray-900 bg-clip-text text-transparent text-center tracking-wide pt-8 lg:pt-0">
                困難點會議管理系統
            </h1>
        </div>

        <!-- 小螢幕專用欄位設定卡片 -->
        <div v-if="showMobileColumnSettings" 
             class="lg:hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[120] p-4"
             @click.self="showMobileColumnSettings = false">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[85vh] flex flex-col modal-content"
                 @click.stop>
                
                <!-- 卡片標題 -->
                <div class="px-6 py-5 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-2xl">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-blue-100 rounded-lg">
                                <i data-lucide="settings" class="w-5 h-5 text-blue-600"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800">欄位顯示設定</h3>
                        </div>
                        <button @click="showMobileColumnSettings = false" 
                            class="p-2 hover:bg-white/80 rounded-lg transition-colors">
                            <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 控制按鈕區 -->
                <div class="px-6 py-4 bg-gray-50 border-b border-gray-100">
                    <div class="flex justify-center gap-4">
                        <button @click="selectAllColumns()"
                            class="flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all shadow-sm hover:shadow-md">
                            <i data-lucide="check-square" class="w-4 h-4"></i>
                            全選
                        </button>
                        <button @click="resetColumnVisibility()"
                            class="flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-all shadow-sm hover:shadow-md">
                            <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                            預設
                        </button>
                    </div>
                </div>
                
                <!-- 欄位列表區 -->
                <div class="flex-1 overflow-y-auto px-6 py-4 custom-scrollbar">
                    <div class="space-y-3">
                        <div v-for="(visible, columnName) in columnVisibility" 
                            :key="columnName"
                            class="group flex items-center gap-4 hover:bg-gray-50 px-3 py-3 rounded-xl transition-all duration-200 border border-transparent hover:border-gray-200 hover:shadow-sm">
                            
                            <input type="checkbox" 
                                :id="'mobile-col-' + columnName"
                                :checked="visible" 
                                @change="toggleColumnVisibility(columnName)"
                                class="w-5 h-5 text-blue-600 focus:ring-blue-500 rounded border-2 border-gray-300 transition-colors cursor-pointer">
                            
                            <label :for="'mobile-col-' + columnName" 
                                class="flex-1 text-sm font-medium text-gray-700 cursor-pointer group-hover:text-gray-900 transition-colors">
                                {{ columnName }}
                            </label>
                            
                            <div class="flex items-center gap-2">
                                <span v-if="visible" 
                                    class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-700 rounded-full">
                                    顯示
                                </span>
                                <span v-else 
                                    class="px-2 py-1 text-xs font-semibold bg-red-100 text-red-600 rounded-full">
                                    隱藏
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 統計與操作區 -->
                <div class="px-6 py-5 border-t border-gray-100 bg-gray-50 rounded-b-2xl">
                    <div class="flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            顯示 <span class="font-bold text-blue-600">{{ visibleColumns.length }}</span> / 
                            <span class="font-bold text-gray-800">{{ Object.keys(columnVisibility).length }}</span> 個欄位
                        </div>
                        <button @click="showMobileColumnSettings = false" 
                            class="flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-all shadow-sm hover:shadow-md">
                            <i data-lucide="check" class="w-4 h-4"></i>
                            完成
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="h-4"></div>
        
        <!-- 中間主體 (表格區塊) - 滿版寬度 -->
        <div v-if="isDataReady" ref="tableContainer"
            class="w-full border-l-0 border-r-0 border-t border-b border-gray-200 shadow-lg overflow-y-auto overflow-x-auto bg-white custom-scrollbar"
            style="height: 78vh;">
            <table class="w-full border-collapse">
                <thead class="sticky top-0 z-30">
                    <tr class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <!-- 項次 -->
                        <th v-if="isColumnVisible('項次')" 
                            class="py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200">
                            項次
                        </th>
                        
                        <!-- 提案日期 -->
                        <th v-if="isColumnVisible('提案日期')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isDateFiltered }">
                            <div ref="DateFilterWrapper" class="relative">
                                <!-- 表頭點擊區域 -->
                                <div @click="toggleDropdown('showDateFilter')"
                                    class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                                    <span>提案日期</span>
                                    <div class="transform transition-transform duration-300" 
                                        :class="{ 'rotate-180': showDateFilter }">
                                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                    </div>
                                </div>
                                <!-- 下拉篩選卡片 -->
                                <transition name="fade">
                                    <div v-if="showDateFilter"
                                        class="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-48 p-2 space-y-2">

                                        <!-- 標題與清除按鈕 -->
                                        <div class="flex justify-between items-center">
                                            <label class="text-sm font-medium text-gray-700">篩選年月</label>
                                            <button @click="clearDateFilter"
                                                class="text-gray-500 text-xs hover:text-red-500 transition">
                                                清除篩選
                                            </button>
                                        </div>
                                        <hr class="border-gray-200" />

                                        <!-- 年月多選清單 -->
                                        <div class="max-h-60 overflow-y-auto space-y-1">
                                            <label 
                                                v-for="yearMonth in uniqueYearMonths" 
                                                :key="yearMonth" 
                                                class="flex items-center gap-2 cursor-pointer hover:bg-blue-50 px-2 py-1 rounded transition"
                                            >
                                                <input 
                                                    type="checkbox" 
                                                    :value="yearMonth" 
                                                    v-model="checkedDates" 
                                                    class="text-blue-600 focus:ring-blue-500 rounded"
                                                />
                                                <span class="text-sm text-gray-700">
                                                    {{ yearMonth }}
                                                </span>
                                            </label>
                                            
                                            <!-- 空狀態 -->
                                            <div v-if="uniqueYearMonths.length === 0" 
                                                class="text-center text-gray-400 text-sm py-4">
                                                沒有可用的日期
                                            </div>
                                        </div>

                                        <!-- 已選擇的數量提示 -->
                                        <div v-if="checkedDates.length > 0" 
                                            class="text-xs text-blue-600 text-center font-medium pt-1 border-t border-gray-200">
                                            已選擇 {{ checkedDates.length }} 個月份
                                        </div>
                                    </div>
                                </transition>
                            </div>
                        </th>
                        
                        <!-- 距今 -->
                        <th v-if="isColumnVisible('距今')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200">
                            <div @click="toggleDaysAgoSort" 
                                class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                                <span>距今</span>
                                <!-- 固定寬度的圖標容器 -->
                                <div class="w-3 h-3 flex items-center justify-center">
                                    <svg v-if="daysAgoSortOrder === 'asc'" 
                                        class="w-3 h-3 text-blue-600" 
                                        fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                                    </svg>
                                    <svg v-else-if="daysAgoSortOrder === 'desc'" 
                                        class="w-3 h-3 text-blue-600 transform rotate-180" 
                                        fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                                    </svg>
                                    <svg v-else 
                                        class="w-3 h-3 text-gray-400" 
                                        fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                                    </svg>
                                </div>
                            </div>
                        </th>
                        
                        <!-- 棟別 -->
                        <th v-if="isColumnVisible('棟別')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isBuildingFiltered }">
                            <div ref="BuildingFilterWrapper" class="relative">
                                <!-- 表頭點擊區域 -->
                                <div @click.stop="toggleDropdown('showBuildingFilter')"
                                    class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                                    <span>棟別</span>
                                    <div class="transform transition-transform duration-300" 
                                        :class="{ 'rotate-180': showBuildingFilter }">
                                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                    </div>
                                </div>
                                
                                <!-- 下拉篩選卡片 -->
                                <transition name="fade">
                                    <div v-if="showBuildingFilter"
                                        class="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-48 p-2 space-y-2">

                                        <!-- 標題與清除按鈕 -->
                                        <div class="flex justify-between items-center">
                                            <label class="text-sm font-medium text-gray-700">篩選棟別</label>
                                            <button @click="clearBuildingFilter"
                                                class="text-gray-500 text-xs hover:text-red-500 transition">
                                                清除篩選
                                            </button>
                                        </div>
                                        <hr class="border-gray-200" />

                                        <!-- 棟別多選清單 -->
                                        <div class="max-h-60 overflow-y-auto space-y-1">
                                            <label 
                                                v-for="building in uniqueBuildings" 
                                                :key="building" 
                                                class="flex items-center gap-2 cursor-pointer hover:bg-blue-50 px-2 py-1 rounded transition"
                                            >
                                                <input 
                                                    type="checkbox" 
                                                    :value="building" 
                                                    v-model="checkedBuildings" 
                                                    class="text-blue-600 focus:ring-blue-500 rounded"
                                                />
                                                <span class="text-sm text-gray-700">
                                                    {{ building }}
                                                </span>
                                            </label>
                                            
                                            <!-- 空狀態 -->
                                            <div v-if="uniqueBuildings.length === 0" 
                                                class="text-center text-gray-400 text-sm py-4">
                                                沒有可用的棟別
                                            </div>
                                        </div>

                                        <!-- 已選擇的數量提示 -->
                                        <div v-if="checkedBuildings.length > 0" 
                                            class="text-xs text-blue-600 text-center font-medium pt-1 border-t border-gray-200">
                                            已選擇 {{ checkedBuildings.length }} 個棟別
                                        </div>
                                    </div>
                                </transition>
                            </div>
                        </th>
                        
                        <!-- 樓層 -->
                        <th v-if="isColumnVisible('樓層')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isFloorFiltered }">
                            <div ref="FloorFilterWrapper" class="relative">
                                <!-- 表頭點擊區域 -->
                                <div @click="toggleDropdown('showFloorFilter')"
                                    class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                                    <span>樓層</span>
                                    <div class="transform transition-transform duration-300" 
                                        :class="{ 'rotate-180': showFloorFilter }">
                                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                    </div>
                                </div>
                                
                                <!-- 下拉篩選卡片 -->
                                <transition name="fade">
                                    <div v-if="showFloorFilter"
                                        class="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-48 p-2 space-y-2">

                                        <!-- 標題與清除按鈕 -->
                                        <div class="flex justify-between items-center">
                                            <label class="text-sm font-medium text-gray-700">篩選樓層</label>
                                            <button @click="clearFloorFilter"
                                                class="text-gray-500 text-xs hover:text-red-500 transition">
                                                清除篩選
                                            </button>
                                        </div>
                                        <hr class="border-gray-200" />

                                        <!-- 樓層多選清單 -->
                                        <div class="max-h-60 overflow-y-auto space-y-1">
                                            <label 
                                                v-for="floor in uniqueFloors" 
                                                :key="floor" 
                                                class="flex items-center gap-2 cursor-pointer hover:bg-green-50 px-2 py-1 rounded transition"
                                            >
                                                <input 
                                                    type="checkbox" 
                                                    :value="floor" 
                                                    v-model="checkedFloors" 
                                                    class="text-green-600 focus:ring-green-500 rounded"
                                                />
                                                <span class="text-sm text-gray-700">
                                                    {{ floor }}
                                                </span>
                                            </label>
                                            
                                            <!-- 空狀態 -->
                                            <div v-if="uniqueFloors.length === 0" 
                                                class="text-center text-gray-400 text-sm py-4">
                                                沒有可用的樓層
                                            </div>
                                        </div>

                                        <!-- 已選擇的數量提示 -->
                                        <div v-if="checkedFloors.length > 0" 
                                            class="text-xs text-green-600 text-center font-medium pt-1 border-t border-gray-200">
                                            已選擇 {{ checkedFloors.length }} 個樓層
                                        </div>
                                    </div>
                                </transition>
                            </div>
                        </th>
                        
                        <!-- 站點 -->
                        <th v-if="isColumnVisible('站點')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isStationFiltered }">
                            <div ref="StationFilterWrapper" class="relative">
                                <!-- 表頭點擊區域 -->
                                <div @click="toggleDropdown('showStationFilter')"
                                    class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                                    <span>站點</span>
                                    <div class="transform transition-transform duration-300" 
                                        :class="{ 'rotate-180': showStationFilter }">
                                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                    </div>
                                </div>
                                
                                <!-- 下拉篩選卡片 -->
                                <transition name="fade">
                                    <div v-if="showStationFilter"
                                        class="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-48 p-2 space-y-2">

                                        <!-- 標題與清除按鈕 -->
                                        <div class="flex justify-between items-center">
                                            <label class="text-sm font-medium text-gray-700">篩選站點</label>
                                            <button @click="clearStationFilter"
                                                class="text-gray-500 text-xs hover:text-red-500 transition">
                                                清除篩選
                                            </button>
                                        </div>
                                        <hr class="border-gray-200" />

                                        <!-- 站點多選清單 -->
                                        <div class="max-h-60 overflow-y-auto space-y-1">
                                            <label 
                                                v-for="station in uniqueStations" 
                                                :key="station" 
                                                class="flex items-center gap-2 cursor-pointer hover:bg-cyan-50 px-2 py-1 rounded transition"
                                            >
                                                <input 
                                                    type="checkbox" 
                                                    :value="station" 
                                                    v-model="checkedStations" 
                                                    class="text-cyan-600 focus:ring-cyan-500 rounded"
                                                />
                                                <span class="text-sm text-gray-700">
                                                    {{ station }}
                                                </span>
                                            </label>
                                            
                                            <!-- 空狀態 -->
                                            <div v-if="uniqueStations.length === 0" 
                                                class="text-center text-gray-400 text-sm py-4">
                                                沒有可用的站點
                                            </div>
                                        </div>

                                        <!-- 已選擇的數量提示 -->
                                        <div v-if="checkedStations.length > 0" 
                                            class="text-xs text-cyan-600 text-center font-medium pt-1 border-t border-gray-200">
                                            已選擇 {{ checkedStations.length }} 個站點
                                        </div>
                                    </div>
                                </transition>
                            </div>
                        </th>
                        
                        <!-- 類別 -->
                        <th v-if="isColumnVisible('類別')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isCategoryFiltered }">
                            <div ref="CategoryFilterWrapper" class="relative">
                                <!-- 表頭點擊區域 -->
                                <div @click="toggleDropdown('showCategoryFilter')"
                                    class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                                    <span>類別</span>
                                    <div class="transform transition-transform duration-300" 
                                        :class="{ 'rotate-180': showCategoryFilter }">
                                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                    </div>
                                </div>
                                
                                <!-- 下拉篩選卡片 -->
                                <transition name="fade">
                                    <div v-if="showCategoryFilter"
                                        class="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-48 p-2 space-y-2">

                                        <!-- 標題與清除按鈕 -->
                                        <div class="flex justify-between items-center">
                                            <label class="text-sm font-medium text-gray-700">篩選類別</label>
                                            <button @click="clearCategoryFilter"
                                                class="text-gray-500 text-xs hover:text-red-500 transition">
                                                清除篩選
                                            </button>
                                        </div>
                                        <hr class="border-gray-200" />

                                        <!-- 類別多選清單 -->
                                        <div class="space-y-1">
                                            <label 
                                                v-for="category in uniqueCategories" 
                                                :key="category" 
                                                class="flex items-center gap-2 cursor-pointer hover:bg-purple-50 px-2 py-1 rounded transition">
                                                <input 
                                                    type="checkbox" 
                                                    :value="category" 
                                                    v-model="checkedCategories" 
                                                    class="text-purple-600 focus:ring-purple-500 rounded" />
                                                <span class="text-sm text-gray-700">{{ category }}</span>
                                            </label>
                                            
                                            <!-- 空狀態 -->
                                            <div v-if="uniqueCategories.length === 0" 
                                                class="text-center text-gray-400 text-sm py-4">
                                                沒有可用的類別
                                            </div>
                                        </div>

                                        <!-- 已選擇的數量提示 -->
                                        <div v-if="checkedCategories.length > 0" 
                                            class="text-xs text-purple-600 text-center font-medium pt-1 border-t border-gray-200">
                                            已選擇 {{ checkedCategories.length }} 個類別
                                        </div>
                                    </div>
                                </transition>
                            </div>
                        </th>
                        
                        <!-- 提案人 -->
                        <th v-if="isColumnVisible('提案人')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isProposerFiltered }">
                            <div ref="ProposerFilterWrapper" class="relative">
                                <div @click="toggleDropdown('showProposerFilter')"
                                    class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                                    <span>提案人</span>
                                    <div class="transform transition-transform duration-300" 
                                        :class="{ 'rotate-180': showProposerFilter }">
                                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                    </div>
                                </div>
                                
                                <transition name="fade">
                                    <div v-if="showProposerFilter"
                                        class="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-48 p-2 space-y-2">
                                        
                                        <div class="flex justify-between items-center">
                                            <label class="text-sm font-medium text-gray-700">篩選提案人</label>
                                            <button @click="clearProposerFilter"
                                                class="text-gray-500 text-xs hover:text-red-500 transition">
                                                清除篩選
                                            </button>
                                        </div>
                                        <hr class="border-gray-200" />

                                        <div class="max-h-60 overflow-y-auto space-y-1">
                                            <label 
                                                v-for="proposer in uniqueProposers" 
                                                :key="proposer" 
                                                class="flex items-center gap-2 cursor-pointer hover:bg-amber-50 px-2 py-1 rounded transition">
                                                <input 
                                                    type="checkbox" 
                                                    :value="proposer" 
                                                    v-model="checkedProposers" 
                                                    class="text-amber-600 focus:ring-amber-500 rounded" />
                                                <span class="text-sm text-gray-700">{{ proposer }}</span>
                                            </label>
                                            
                                            <div v-if="uniqueProposers.length === 0" 
                                                class="text-center text-gray-400 text-sm py-4">
                                                沒有可用的提案人
                                            </div>
                                        </div>

                                        <div v-if="checkedProposers.length > 0" 
                                            class="text-xs text-amber-600 text-center font-medium pt-1 border-t border-gray-200">
                                            已選擇 {{ checkedProposers.length }} 個提案人
                                        </div>
                                    </div>
                                </transition>
                            </div>
                        </th>
                                                
                        <!-- 案件分類 -->
                        <th v-if="isColumnVisible('案件分類')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isCaseCategoriesFiltered }">

                        <div ref="caseCategoriesFilterWrapper" class="relative">
                            <div @click="toggleDropdown('showCaseCategoriesFilter')"
                                class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                            <span>案件分類</span>
                            <div class="transform transition-transform duration-300" 
                                :class="{ 'rotate-180': showCaseCategoriesFilter }">
                                <i data-lucide="chevron-down" class="w-4 h-4"></i>
                            </div>
                            </div>

                            <transition name="fade">
                            <div v-if="showCaseCategoriesFilter"
                                class="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-48 p-2 space-y-2">
                                
                                <div class="flex justify-between items-center">
                                <label class="text-sm font-medium text-gray-700">篩選案件分類</label>
                                <button @click="clearCaseCategoriesFilter"
                                    class="text-gray-500 text-xs hover:text-red-500 transition">
                                    清除篩選
                                </button>
                                </div>
                                <hr class="border-gray-200" />

                                <div class="max-h-60 overflow-y-auto space-y-1">
                                <label 
                                    v-for="caseCategory in uniqueCaseCategories" 
                                    :key="caseCategory" 
                                    class="flex items-center gap-2 cursor-pointer hover:bg-amber-50 px-2 py-1 rounded transition">
                                    <input 
                                        type="checkbox" 
                                        :value="caseCategory" 
                                        v-model="checkedCaseCategories" 
                                        class="text-amber-600 focus:ring-amber-500 rounded" />
                                    <span class="text-sm text-gray-700">{{ caseCategory }}</span>
                                </label>

                                <div v-if="uniqueCaseCategories.length === 0" 
                                    class="text-center text-gray-400 text-sm py-4">
                                    沒有可用的案件分類
                                </div>
                                </div>

                                <div v-if="checkedCaseCategories.length > 0" 
                                    class="text-xs text-amber-600 text-center font-medium pt-1 border-t border-gray-200">
                                已選擇 {{ checkedCaseCategories.length }} 個案件分類
                                </div>
                            </div>
                            </transition>
                        </div>
                        </th>
                        
                        <!-- 問題描述 -->
                        <th v-if="isColumnVisible('問題描述')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isDescriptionFiltered }">
                            <div ref="DescriptionFilterWrapper" class="relative">
                                <div @click="toggleDropdown('showDescriptionFilter')"
                                    class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                                    <span>問題描述</span>
                                    <div class="transform transition-transform duration-300" 
                                        :class="{ 'rotate-180': showDescriptionFilter }">
                                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                    </div>
                                </div>
                                
                                <transition name="fade">
                                    <div v-if="showDescriptionFilter"
                                        class="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-80 p-2 space-y-2">
                                        
                                        <div class="flex justify-between items-center">
                                            <label class="text-sm font-medium text-gray-700">篩選問題描述</label>
                                            <button @click="clearDescriptionFilter"
                                                class="text-gray-500 text-xs hover:text-red-500 transition">
                                                清除篩選
                                            </button>
                                        </div>
                                        <hr class="border-gray-200" />

                                        <!-- 內部搜尋框 -->
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <i data-lucide="search" class="w-3 h-3 text-gray-400"></i>
                                            </div>
                                            <input 
                                                v-model="descriptionSearchText"
                                                type="text" 
                                                placeholder="搜尋問題描述..."
                                                class="block w-full pl-8 pr-8 py-2 border border-gray-200 rounded text-xs placeholder-gray-400 focus:ring-1 focus:ring-orange-500 focus:border-orange-500"
                                                style="text-align: left; padding-left: 12px;"
                                                @click.stop
                                            />
                                            <button 
                                                v-if="descriptionSearchText" 
                                                @click.stop="descriptionSearchText = ''"
                                                class="absolute inset-y-0 right-0 pr-2 flex items-center text-gray-400 hover:text-gray-600">
                                                <i data-lucide="x" class="w-3 h-3"></i>
                                            </button>
                                        </div>

                                        <div class="max-h-60 overflow-y-auto space-y-1">
                                            <label 
                                                v-for="description in filteredDescriptions" 
                                                :key="description" 
                                                class="flex items-start gap-2 cursor-pointer hover:bg-orange-50 px-2 py-1 rounded transition">
                                                <input 
                                                    type="checkbox" 
                                                    :value="description" 
                                                    v-model="checkedDescriptions" 
                                                    class="text-orange-600 focus:ring-orange-500 rounded mt-1 flex-shrink-0" />
                                                <span class="text-sm text-gray-700 leading-relaxed">{{ description }}</span>
                                            </label>
                                            
                                            <div v-if="filteredDescriptions.length === 0" 
                                                class="text-center text-gray-400 text-sm py-4">
                                                沒有找到相關的問題描述
                                            </div>
                                        </div>

                                        <div v-if="checkedDescriptions.length > 0" 
                                            class="text-xs text-orange-600 text-center font-medium pt-1 border-t border-gray-200">
                                            已選擇 {{ checkedDescriptions.length }} 個描述
                                        </div>
                                    </div>
                                </transition>
                            </div>
                        </th>

                        <!-- PDCA -->
                        <th v-if="isColumnVisible('PDCA')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isPDCAFiltered }">

                        <div ref="PDCAFilterWrapper" class="relative">
                            <div @click="toggleDropdown('showPDCAFilter')"
                                class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                            <span>PDCA</span>
                            <div class="transform transition-transform duration-300" 
                                :class="{ 'rotate-180': showPDCAFilter }">
                                <i data-lucide="chevron-down" class="w-4 h-4"></i>
                            </div>
                            </div>

                            <transition name="fade">
                            <div v-if="showPDCAFilter"
                                class="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-48 p-2 space-y-2">
                                
                                <div class="flex justify-between items-center">
                                <label class="text-sm font-medium text-gray-700">篩選 PDCA</label>
                                <button @click="clearPDCAFilter"
                                        class="text-gray-500 text-xs hover:text-red-500 transition">
                                    清除篩選
                                </button>
                                </div>
                                <hr class="border-gray-200" />

                                <div class="max-h-60 overflow-y-auto space-y-1">
                                <label 
                                    v-for="pdca in uniquePDCA" 
                                    :key="pdca" 
                                    class="flex items-center gap-2 cursor-pointer hover:bg-green-50 px-2 py-1 rounded transition">
                                    <input 
                                    type="checkbox" 
                                    :value="pdca" 
                                    v-model="checkedPDCA" 
                                    class="text-green-600 focus:ring-green-500 rounded" />
                                    <span class="text-sm text-gray-700">{{ pdca }}</span>
                                </label>

                                <div v-if="uniquePDCA.length === 0" 
                                    class="text-center text-gray-400 text-sm py-4">
                                    沒有可用的 PDCA
                                </div>
                                </div>

                                <div v-if="checkedPDCA.length > 0" 
                                    class="text-xs text-green-600 text-center font-medium pt-1 border-t border-gray-200">
                                已選擇 {{ checkedPDCA.length }} 個 PDCA
                                </div>
                            </div>
                            </transition>
                        </div>
                        </th>
                        
                        <!-- 截止日期 -->
                        <th v-if="isColumnVisible('截止日期')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isDueDateFiltered }">

                        <div ref="DueDateFilterWrapper" class="relative">
                            <div @click="toggleDropdown('showDueDateFilter')"
                                class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                            <span>截止日期</span>
                            <div class="transform transition-transform duration-300" 
                                :class="{ 'rotate-180': showDueDateFilter }">
                                <i data-lucide="chevron-down" class="w-4 h-4"></i>
                            </div>
                            </div>

                            <transition name="fade">
                            <div v-if="showDueDateFilter"
                                class="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-48 p-2 space-y-2">
                                
                                <div class="flex justify-between items-center">
                                <label class="text-sm font-medium text-gray-700">篩選截止日期</label>
                                <button @click="clearDueDateFilter"
                                        class="text-gray-500 text-xs hover:text-red-500 transition">
                                    清除篩選
                                </button>
                                </div>
                                <hr class="border-gray-200" />

                                <div class="max-h-60 overflow-y-auto space-y-1">
                                <label 
                                    v-for="due in uniqueDueDates" 
                                    :key="due" 
                                    class="flex items-center gap-2 cursor-pointer hover:bg-rose-50 px-2 py-1 rounded transition">
                                    <input 
                                    type="checkbox" 
                                    :value="due" 
                                    v-model="checkedDueDates" 
                                    class="text-rose-600 focus:ring-rose-500 rounded" />
                                    <span class="text-sm text-gray-700">{{ due }}</span>
                                </label>

                                <div v-if="uniqueDueDates.length === 0" 
                                    class="text-center text-gray-400 text-sm py-4">
                                    沒有可用的截止日期
                                </div>
                                </div>

                                <div v-if="checkedDueDates.length > 0" 
                                    class="text-xs text-rose-600 text-center font-medium pt-1 border-t border-gray-200">
                                已選擇 {{ checkedDueDates.length }} 個截止日期
                                </div>
                            </div>
                            </transition>
                        </div>
                        </th>

                        
                        <!-- 專案Owner -->
                        <th v-if="isColumnVisible('專案Owner')"
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isProjectOwnerFiltered }">

                            <div ref="ProjectOwnerFilterWrapper" class="relative">
                                <div @click="toggleDropdown('showProjectOwnerFilter')"
                                    class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                                    <span>專案Owner</span>
                                    <div class="transform transition-transform duration-300"
                                        :class="{ 'rotate-180': showProjectOwnerFilter }">
                                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                    </div>
                                </div>

                                <transition name="fade">
                                    <div v-if="showProjectOwnerFilter"
                                        class="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-48 p-2 space-y-2">

                                        <div class="flex justify-between items-center">
                                            <label class="text-sm font-medium text-gray-700">篩選專案Owner</label>
                                            <button @click="clearProjectOwnerFilter"
                                                    class="text-gray-500 text-xs hover:text-red-500 transition">
                                                清除篩選
                                            </button>
                                        </div>
                                        <hr class="border-gray-200" />

                                        <!-- 多選清單 -->
                                        <div class="max-h-60 overflow-y-auto space-y-1">
                                            <label v-for="owner in uniqueProjectOwners"
                                                :key="owner"
                                                class="flex items-center gap-2 cursor-pointer hover:bg-purple-50 px-2 py-1 rounded transition">
                                                <input
                                                    type="checkbox"
                                                    :value="owner"
                                                    v-model="checkedProjectOwners"
                                                    class="text-purple-600 focus:ring-purple-500 rounded" />
                                                <span class="text-sm text-gray-700">{{ owner }}</span>
                                            </label>

                                            <div v-if="uniqueProjectOwners.length === 0"
                                                class="text-center text-gray-400 text-sm py-4">
                                                沒有可用的Owner
                                            </div>
                                        </div>

                                        <div v-if="checkedProjectOwners.length > 0"
                                            class="text-xs text-purple-600 text-center font-medium pt-1 border-t border-gray-200">
                                            已選擇 {{ checkedProjectOwners.length }} 個Owner
                                        </div>
                                    </div>
                                </transition>
                            </div>
                        </th>


                        <!-- 項目DueDate -->
                        <th v-if="isColumnVisible('項目DueDate')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isItemDueDateFiltered }">

                        <div ref="ItemDueDateFilterWrapper" class="relative">
                            <div @click="toggleDropdown('showItemDueDateFilter')"
                                class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                            <span>項目DueDate</span>
                            <div class="transform transition-transform duration-300" 
                                :class="{ 'rotate-180': showItemDueDateFilter }">
                                <i data-lucide="chevron-down" class="w-4 h-4"></i>
                            </div>
                            </div>

                            <transition name="fade">
                            <div v-if="showItemDueDateFilter"
                                class="absolute top-full left-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-48 p-2 space-y-2">
                                
                                <div class="flex justify-between items-center">
                                <label class="text-sm font-medium text-gray-700">篩選 項目DueDate</label>
                                <button @click="clearItemDueDateFilter"
                                        class="text-gray-500 text-xs hover:text-red-500 transition">
                                    清除篩選
                                </button>
                                </div>
                                <hr class="border-gray-200" />

                                <div class="max-h-60 overflow-y-auto space-y-1">
                                <label v-for="date in uniqueItemDueDates" :key="date" 
                                        class="flex items-center gap-2 cursor-pointer hover:bg-green-50 px-2 py-1 rounded transition">
                                    <input type="checkbox" :value="date" v-model="checkedItemDueDates" 
                                        class="text-green-600 focus:ring-green-500 rounded" />
                                    <span class="text-sm text-gray-700">{{ date }}</span>
                                </label>
                                <div v-if="uniqueItemDueDates.length === 0" class="text-center text-gray-400 text-sm py-4">
                                    沒有可用的項目DueDate
                                </div>
                                </div>

                                <div v-if="checkedItemDueDates.length > 0" 
                                    class="text-xs text-green-600 text-center font-medium pt-1 border-t border-gray-200">
                                已選擇 {{ checkedItemDueDates.length }} 個
                                </div>
                            </div>
                            </transition>
                        </div>
                        </th>

                        
                        <!-- 進度紀錄 -->
                        <th v-if="isColumnVisible('進度紀錄')" 
                            class="py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200">
                            進度紀錄
                        </th>
                        
                        <!-- Status -->
                        <th v-if="isColumnVisible('Status')" 
                            class="relative py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200"
                            :class="{ 'bg-yellow-100 text-blue-600': isStatusFiltered }">

                        <div ref="StatusFilterWrapper" class="relative">
                            <div @click="toggleDropdown('showStatusFilter')"
                                class="cursor-pointer flex items-center justify-center gap-1 hover:text-blue-600 transition">
                            <span>Status</span>
                            <div class="transform transition-transform duration-300" 
                                :class="{ 'rotate-180': showStatusFilter }">
                                <i data-lucide="chevron-down" class="w-4 h-4"></i>
                            </div>
                            </div>

                            <transition name="fade">
                            <div v-if="showStatusFilter"
                                class="absolute top-full left-[-20px] mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 w-48 p-2 space-y-2">
                                
                                <div class="flex justify-between items-center">
                                <label class="text-sm font-medium text-gray-700">篩選 Status</label>
                                <button @click="clearStatusFilter"
                                        class="text-gray-500 text-xs hover:text-red-500 transition">
                                    清除篩選
                                </button>
                                </div>
                                <hr class="border-gray-200" />

                                <div class="max-h-60 overflow-y-auto space-y-1">
                                <label 
                                    v-for="status in uniqueStatus" 
                                    :key="status" 
                                    class="flex items-center gap-2 cursor-pointer hover:bg-blue-50 px-2 py-1 rounded transition">
                                    <input 
                                    type="checkbox" 
                                    :value="status" 
                                    v-model="checkedStatus" 
                                    class="text-blue-600 focus:ring-blue-500 rounded" />
                                    <span class="text-sm text-gray-700">{{ status }}</span>
                                </label>

                                <div v-if="uniqueStatus.length === 0" 
                                    class="text-center text-gray-400 text-sm py-4">
                                    沒有可用的 Status
                                </div>
                                </div>

                                <div v-if="checkedStatus.length > 0" 
                                    class="text-xs text-blue-600 text-center font-medium pt-1 border-t border-gray-200">
                                已選擇 {{ checkedStatus.length }} 個 Status
                                </div>
                            </div>
                            </transition>
                        </div>
                        </th>
                        
                        <!-- 操作 -->
                        <th v-if="isColumnVisible('操作')" 
                            class="py-3 px-2 text-sm font-semibold text-gray-700 text-center whitespace-nowrap border-b border-gray-200">
                            操作
                        </th>
                    </tr>
                </thead>

                <tbody 
                    @mouseleave="hoverRowId = null"
                    >
                    <tr 
                        v-for="record in filteredData" 
                        :key="record.id || record.項次"
                        @mouseenter="hoverRowId = record.id || record.項次"
                        @click="selectRow(record.id || record.項次)"
                        :class="[
                        'border-t border-gray-300 transition-colors cursor-pointer',
                        record.Status === 'Reject'
                            ? 'bg-gray-100 opacity-60'
                            : (hoverRowId 
                                ? (hoverRowId == (record.id || record.項次) ? 'bg-blue-200' : '') 
                                : (selectedRowId == (record.id || record.項次) ? 'bg-blue-200' : '')
                            )
                        ]"
                    >
                                        
                        <!-- 項次 -->
                        <td v-if="isColumnVisible('項次')" 
                            class="py-2 px-4 text-sm text-center">
                            {{ record.項次 }}
                        </td>
                        
                        <!-- 提案日期 -->
                        <td v-if="isColumnVisible('提案日期')" 
                            class="py-2 px-4 text-sm text-center">
                            {{ formatDate(record.提案日期) }}
                        </td>
                        
                        <!-- 距今 -->
                        <td v-if="isColumnVisible('距今')" 
                            class="py-2 px-4 text-sm text-center min-w-[20px]" :class="record.距今樣式">
                            {{ record.距今 }}
                        </td>
                        
                        <!-- 棟別 -->
                        <td v-if="isColumnVisible('棟別')" 
                            class="py-2 px-4 text-sm">
                            <div class="flex flex-wrap gap-1 justify-center">
                                <span v-for="building in getBuildingArray(record.棟別)" 
                                    :key="building"
                                    :class="getBuildingTagClass(building)">
                                {{ building }}
                                </span>
                            </div>
                        </td>
                        
                        <!-- 樓層 -->
                        <td v-if="isColumnVisible('樓層')" 
                            class="py-2 px-4 text-sm">
                            <div class="flex flex-wrap gap-1 justify-center">
                                <span v-for="floor in getFloorArray(record.樓層)" 
                                    :key="floor"
                                    :class="getFloorTagClass(floor)">
                                {{ floor }}
                                </span>
                            </div>
                        </td>
                        
                        <!-- 站點 -->
                        <td v-if="isColumnVisible('站點')" 
                            class="py-2 px-4 text-sm">
                            <div class="flex flex-wrap gap-1 justify-center">
                                <span v-for="station in getStationArray(record.站點)" 
                                    :key="station"
                                    class="inline-block px-2 py-1 text-xs font-medium bg-cyan-100 text-cyan-800 rounded-md border border-cyan-200 whitespace-nowrap">
                                {{ station }}
                                </span>
                            </div>
                        </td>
                        
                        <!-- 類別 -->
                        <td v-if="isColumnVisible('類別')" 
                            class="py-2 px-4 text-sm text-center min-w-[60px]">
                            {{ record.類別 }}
                        </td>
                        
                        <!-- 提案人 -->
                        <td v-if="isColumnVisible('提案人')" 
                            class="py-2 px-4 text-sm text-center min-w-[40px]">
                            {{ record.提案人 }}
                        </td>
                        
                        <!-- 案件分類 -->
                        <td v-if="isColumnVisible('案件分類')" 
                            class="py-2 px-4 text-sm text-center">
                            {{ record.案件分類 }}
                        </td>
                        
                        <!-- 問題描述 -->
                        <td v-if="isColumnVisible('問題描述')" 
                            class="px-4 py-2 text-sm whitespace-pre-wrap break-words min-w-[180px]">
                            {{ formatText(record.問題描述) }}
                        </td>
                        
                        <!-- PDCA -->
                        <td v-if="isColumnVisible('PDCA')" 
                            class="py-2 px-4 text-sm text-center">
                            <span :class="['px-2 py-1 rounded-full text-xs font-medium',
                                record.PDCA === 'P' ? 'bg-blue-100 text-blue-700' :
                                record.PDCA === 'D' ? 'bg-yellow-100 text-yellow-700' :
                                record.PDCA === 'C' ? 'bg-purple-100 text-purple-700' :
                                'bg-green-100 text-green-700']">
                                {{ record.PDCA }}
                            </span>
                        </td>
                        
                        <!-- 截止日期 -->
                        <td v-if="isColumnVisible('截止日期')" 
                            class="py-2 px-4 text-sm text-center">
                            {{ formatDate(record.截止日期) }}
                        </td>
                                                
                        <!-- 專案Owner -->
                        <td v-if="isColumnVisible('專案Owner')" 
                            class="py-2 px-4 text-sm">
                            <div class="flex flex-wrap gap-1 justify-center">
                                <span v-for="owner in getOwnerArray(record.專案Owner)" 
                                    :key="owner"
                                    class="inline-block px-2 py-1 text-xs font-medium bg-purple-100 text-purple-800 rounded-md border border-purple-200 whitespace-nowrap">
                                    {{ owner }}
                                </span>
                            </div>
                        </td>
                        
                        <!-- 項目DueDate -->
                        <td v-if="isColumnVisible('項目DueDate')" 
                            class="py-2 px-4 text-sm text-center">
                            {{ formatDate(record.項目DueDate) }}
                        </td>
                        
                        <!-- 進度紀錄 -->
                        <td v-if="isColumnVisible('進度紀錄')" 
                            class="px-4 py-2 text-sm whitespace-pre-wrap break-words min-w-[180px]">
                            {{ formatRecordText(record.進度紀錄[record.進度紀錄.length - 1]) }}
                        </td>
                        
                        <!-- Status -->
                        <td v-if="isColumnVisible('Status')" 
                            class="py-2 px-4 text-sm text-center">
                            <span v-if="record.Status === 'Reject'" 
                                class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-semibold whitespace-nowrap">
                                Reject
                            </span>
                            <span v-else-if="record.Status === 'On Going'" 
                                class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-semibold whitespace-nowrap">
                                {{ record.Status }}
                            </span>
                            <span v-else-if="record.Status === 'New'"
                                class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-semibold whitespace-nowrap">
                                {{ record.Status }}
                            </span>
                            <span v-else class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-xs whitespace-nowrap">
                                {{ record.Status }}
                            </span>
                        </td>
                        
                        <!-- 操作 -->
                        <td v-if="isColumnVisible('操作')" 
                            class="py-2 px-4 text-sm text-center">
                            <div class="flex flex-col items-center gap-1">
                                <!-- 查看/修正按鈕 -->
                                <button @click="editRecord(record)" 
                                    :class="['group flex items-center gap-1 font-medium py-1 px-2 rounded-md shadow-sm transition-all duration-200 hover:shadow-md text-xs',
                                             record.Status === 'Reject' || userRole === 'proposer'
                                             ? 'bg-gray-400 hover:bg-gray-500 text-white' 
                                             : 'bg-amber-500 hover:bg-amber-600 text-white']">
                                    <i :data-lucide="record.Status === 'Reject' || userRole === 'proposer' ? 'eye' : 'edit'" class="w-3 h-3"></i>
                                    <span>{{ record.Status === 'Reject' || userRole === 'proposer' ? '查看' : '修正' }}</span>
                                </button>
                                
                                <!-- 編輯人/管理員：移除按鈕 -->
                                <button v-if="(userRole === 'editor' || userRole === 'admin') && record.Status !== 'Reject'"
                                    @click="rejectItem(record)" 
                                    class="group flex items-center gap-1 bg-red-500 hover:bg-red-600 text-white font-medium py-1 px-2 rounded-md shadow-sm transition-all duration-200 hover:shadow-md text-xs">
                                    <i data-lucide="trash" class="w-3 h-3"></i>
                                    <span>移除</span>
                                </button>
                                
                                <!-- 管理員：復原按鈕 -->
                                <button v-if="userRole === 'admin' && record.Status === 'Reject'"
                                    @click="unrejectItem(record)" 
                                    class="group flex items-center gap-1 bg-green-500 hover:bg-green-600 text-white font-medium py-1 px-2 rounded-md shadow-sm transition-all duration-200 hover:shadow-md text-xs">
                                    <i data-lucide="rotate-ccw" class="w-3 h-3"></i>
                                    <span>復原</span>
                                </button>
                                
                                <!-- 管理員：徹底刪除按鈕 -->
                                <button v-if="userRole === 'admin' && record.Status === 'Reject'"
                                    @click="permanentDeleteItem(record)" 
                                    class="group flex items-center gap-1 bg-red-700 hover:bg-red-800 text-white font-medium py-1 px-2 rounded-md shadow-sm transition-all duration-200 hover:shadow-md text-xs">
                                    <i data-lucide="trash-2" class="w-3 h-3"></i>
                                    <span>徹底刪除</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- 資料尚未完成時顯示載入動畫 -->
        <div v-else class="w-full h-[78vh] flex items-center justify-center bg-white">
            <div class="loader"></div>
        </div>

        <!-- 新增區塊 Modal -->
        <div v-if="showAddModal" 
             class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] modal-backdrop">
            <div class="bg-white rounded-2xl shadow-2xl w-[95%] max-w-[1100px] max-h-[85vh] flex flex-col modal-content">
                
                <!-- Modal Header -->
                <div class="px-8 py-6 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-2xl">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-blue-100 rounded-lg">
                                <i data-lucide="file-plus" class="w-6 h-6 text-blue-600"></i>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800">新增困難點</h2>
                        </div>
                        <button @click="cancelAdd" 
                            class="p-2 hover:bg-white/80 rounded-lg transition-colors">
                            <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                        </button>
                    </div>
                </div>

                <!-- Modal Body -->
                <div class="flex-1 px-8 py-6 overflow-y-auto custom-scrollbar">
                    <div class="grid grid-cols-4 gap-5">
                        
                        <!-- 第一行 -->
                        <div class="group">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="hash" class="w-4 h-4 text-gray-400"></i>
                                項次
                            </label>
                            <input v-model="newRecord.項次" 
                                class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed" 
                                readonly />
                        </div>

                        <div class="group">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="calendar" class="w-4 h-4 text-gray-400"></i>
                                提案日期
                            </label>
                            <input
                                type="date"
                                :value="newRecord.提案日期.slice(0,4) + '-' + newRecord.提案日期.slice(4,6) + '-' + newRecord.提案日期.slice(6,8)"
                                @change="updateDate('提案日期', $event.target.value)"
                                class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed"
                                readonly />
                        </div>

                        <!-- 棟別多選 -->
                        <div class="group relative" ref="BuildingDropdown">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="building-2" class="w-4 h-4 text-gray-400"></i>
                                棟別
                            </label>
                            <div @click="toggleBuildingDropdown"
                                class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm cursor-pointer bg-white hover:border-blue-400 hover:shadow-sm transition-all input-focus flex items-center justify-between">
                                <div v-if="newRecord.棟別.length" class="flex flex-wrap gap-1.5">
                                    <span v-for="b in newRecord.棟別" :key="b"
                                        class="group inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-medium tag">
                                        {{ b }}
                                        <button @click.stop="removeBuildingSelection(b)" 
                                            class="hover:bg-blue-200 rounded-full p-0.5 transition-colors">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                            </svg>
                                        </button>
                                    </span>
                                </div>
                                <span v-else class="text-gray-400">請選擇棟別</span>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400"></i>
                            </div>
                            <div v-if="showBuildingDropdown"
                                class="absolute mt-2 w-full border border-gray-200 rounded-lg bg-white shadow-xl z-20 max-h-48 overflow-y-auto">
                                <!-- 全棟別選項 -->
                                <button @click.stop="toggleBuildingSelection('全棟別')"
                                    :class="['w-full text-left px-4 py-2.5 hover:bg-blue-50 flex items-center gap-3 dropdown-item border-b border-gray-200',
                                        newRecord.棟別.includes('全棟別') ? 'bg-blue-50 text-blue-700 font-medium' : 'font-medium']">
                                    <input type="checkbox" :checked="newRecord.棟別.includes('全棟別')" 
                                        class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500" @click.stop>
                                    全棟別
                                </button>
                                <!-- 個別棟別選項 -->
                                <button v-for="f in buildings" :key="f"
                                    @click.stop="toggleBuildingSelection(f)"
                                    :class="['w-full text-left px-4 py-2.5 flex items-center gap-3 dropdown-item',
                                        newRecord.棟別.includes('全棟別') ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-50',
                                        newRecord.棟別.includes(f) ? 'bg-blue-50 text-blue-700' : '']">
                                    <input type="checkbox" 
                                        :checked="newRecord.棟別.includes(f)" 
                                        :disabled="newRecord.棟別.includes('全棟別')"
                                        class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500" 
                                        @click.stop>
                                    {{ f }}
                                </button>
                            </div>
                        </div>

                        <!-- 樓層多選 -->
                        <div class="group relative" ref="floorDropdown">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="layers" class="w-4 h-4 text-gray-400"></i>
                                樓層
                            </label>
                            <div @click="toggleFloorDropdown"
                                class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm cursor-pointer bg-white hover:border-green-400 hover:shadow-sm transition-all input-focus flex items-center justify-between">
                                <div v-if="newRecord.樓層.length" class="flex flex-wrap gap-1.5">
                                    <span v-for="f in newRecord.樓層" :key="f"
                                        class="group inline-flex items-center gap-1 px-2 py-0.5 bg-green-100 text-green-700 rounded text-xs font-medium tag">
                                        {{ f }}
                                        <button @click.stop="removeFloorSelection(f)" 
                                            class="hover:bg-green-200 rounded-full p-0.5 transition-colors">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                            </svg>
                                        </button>
                                    </span>
                                </div>
                                <span v-else class="text-gray-400">請選擇樓層</span>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400"></i>
                            </div>
                            <div v-if="showFloorDropdown"
                                class="absolute mt-2 w-full border border-gray-200 rounded-lg bg-white shadow-xl z-20 max-h-48 overflow-y-auto">
                                <!-- 全樓層選項 -->
                                <button @click.stop="toggleFloorSelection('全樓層')"
                                    :class="['w-full text-left px-4 py-2.5 hover:bg-green-50 flex items-center gap-3 dropdown-item border-b border-gray-200',
                                        newRecord.樓層.includes('全樓層') ? 'bg-green-50 text-green-700 font-medium' : 'font-medium']">
                                    <input type="checkbox" :checked="newRecord.樓層.includes('全樓層')" 
                                        class="w-4 h-4 text-green-600 rounded focus:ring-green-500" @click.stop>
                                    全樓層
                                </button>
                                <!-- 個別樓層選項 -->
                                <button v-for="f in floors" :key="f"
                                    @click.stop="toggleFloorSelection(f)"
                                    :class="['w-full text-left px-4 py-2.5 flex items-center gap-3 dropdown-item',
                                        newRecord.樓層.includes('全樓層') ? 'opacity-50 cursor-not-allowed' : 'hover:bg-green-50',
                                        newRecord.樓層.includes(f) ? 'bg-green-50 text-green-700' : '']">
                                    <input type="checkbox" 
                                        :checked="newRecord.樓層.includes(f)" 
                                        :disabled="newRecord.樓層.includes('全樓層')"
                                        class="w-4 h-4 text-green-600 rounded focus:ring-green-500" 
                                        @click.stop>
                                    {{ f }}
                                </button>
                            </div>
                        </div>

                        <!-- 第二行 -->
                        <div class="group col-span-2">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="map-pin" class="w-4 h-4 text-gray-400"></i>
                                站點 (按 Enter 可新增多個)
                            </label>
                            <textarea v-model="newRecord.站點" 
                                @keydown="handleStationKeydown"
                                class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all input-focus resize-none" 
                                rows="2"
                                placeholder="輸入站點，按 Enter 可新增多個站點"></textarea>
                        </div>

                        <div class="group relative" ref="categoryDropdown">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="tag" class="w-4 h-4 text-gray-400"></i>
                                類別
                            </label>
                            <div @click="toggleCategoryDropdown"
                                class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm cursor-pointer bg-white hover:border-purple-400 hover:shadow-sm transition-all input-focus flex items-center justify-between">
                                <span :class="newRecord.類別 ? 'text-gray-900' : 'text-gray-400'">
                                    {{ newRecord.類別 || '請選擇類別' }}
                                </span>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400"></i>
                            </div>
                            <div v-if="showCategoryDropdown"
                                class="absolute mt-2 w-full border border-gray-200 rounded-lg bg-white shadow-xl z-20 max-h-48 overflow-y-auto">
                                <!-- 預設類別選項 -->
                                <button v-for="category in categories" :key="category"
                                    @click.stop="selectCategory(category)"
                                    :class="['w-full text-left px-4 py-2.5 hover:bg-purple-50 transition-colors',
                                        newRecord.類別 === category ? 'bg-purple-50 text-purple-700 font-medium' : '']">
                                    {{ category }}
                                </button>
                            </div>
                        </div>

                        <div class="group">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="user" class="w-4 h-4 text-gray-400"></i>
                                提案人
                            </label>
                            <!-- <input v-model="newRecord.提案人"  -->
                            <input v-model="this.infoname" 
                                class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all input-focus" 
                                placeholder="輸入提案人" />
                        </div>

                        <!-- 第三行 -->
                        <div class="group relative" ref="caseCategoryDropdown">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="folder" class="w-4 h-4 text-gray-400"></i>
                                案件分類
                            </label>
                            <div @click="toggleCaseCategoryDropdown"
                                class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm cursor-pointer bg-white hover:border-orange-400 hover:shadow-sm transition-all input-focus flex items-center justify-between">
                                <span :class="newRecord.案件分類 ? 'text-gray-900' : 'text-gray-400'">
                                    {{ newRecord.案件分類 || '請選擇案件分類' }}
                                </span>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400"></i>
                            </div>
                            <div v-if="showCaseCategoryDropdown"
                                class="absolute mt-2 w-full border border-gray-200 rounded-lg bg-white shadow-xl z-20 max-h-48 overflow-y-auto">
                                <button v-for="caseCategory in caseCategories" :key="caseCategory"
                                    @click.stop="selectCaseCategory(caseCategory)"
                                    :class="['w-full text-left px-4 py-2.5 hover:bg-orange-50 transition-colors',
                                        newRecord.案件分類 === caseCategory ? 'bg-orange-50 text-orange-700 font-medium' : '']">
                                    {{ caseCategory }}
                                </button>
                            </div>
                        </div>

                        <div class="group">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="repeat" class="w-4 h-4 text-gray-400"></i>
                                PDCA
                            </label>
                            <select v-model="newRecord.PDCA" 
                                class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all input-focus">
                                <option value="P">P - Plan (計劃)</option>
                                <option value="D">D - Do (執行)</option>
                                <option value="C">C - Check (檢查)</option>
                                <option value="A">A - Act (行動)</option>
                            </select>
                        </div>

                        <div class="group">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="calendar-x" class="w-4 h-4 text-gray-400"></i>
                                截止日期
                            </label>
                            <input v-model="newRecord.截止日期"
                                class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed"
                                readonly />
                        </div>

                        <div class="group">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="user-check" class="w-4 h-4 text-gray-400"></i>
                                專案Owner
                            </label>
                            <!-- 直接綁定到 newRecord.專案Owner 字串 -->
                            <input
                                v-model="newRecord.專案Owner"
                                @keydown.enter="handleOwnerKeydown"
                                type="text"
                                class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all"
                                placeholder="請於修正介面新增"
                                readonly
                            />
                        </div>

                        <!-- 第四行 -->
                        <div class="group">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="calendar-check" class="w-4 h-4 text-gray-400"></i>
                                項目DueDate
                            </label>
                            <input v-model="newRecord.項目DueDate"
                                class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 cursor-not-allowed"
                                readonly />
                        </div>

                        <div class="group">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="activity" class="w-4 h-4 text-gray-400"></i>
                                Status
                            </label>
                            <select v-model="newRecord.Status" 
                                class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all input-focus">
                                <option value="New" selected>New</option>
                                <!-- <option value="On Going">On Going</option>
                                <option value="Done">Done</option> -->
                            </select>
                        </div>

                        <!-- 問題描述 -->
                        <div class="group col-span-4">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="alert-circle" class="w-4 h-4 text-gray-400"></i>
                                問題描述
                            </label>
                            <textarea v-model="newRecord.問題描述" 
                                class="w-full px-4 py-3 border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all input-focus resize-none" 
                                rows="4"
                                placeholder="請詳細描述問題..."></textarea>
                        </div>

                        <!-- ✅ 圖片上傳區塊 -->
                        <div class="group col-span-4 mt-2">
                            <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                <i data-lucide="image" class="w-4 h-4 text-gray-400"></i>
                                附加圖片
                                <span class="text-xs text-gray-400 font-normal">(可多選，支援 PNG/JPG/GIF/WebP)</span>
                            </label>
                            
                            <!-- 拖曳上傳區域 -->
                            <div 
                                class="border-2 border-dashed rounded-xl p-6 text-center cursor-pointer transition-all"
                                :class="isDragging 
                                    ? 'border-blue-500 bg-blue-50' 
                                    : 'border-gray-300 hover:border-blue-400 hover:bg-blue-50/30'"
                                @click="$refs.imageInput.click()"
                                @dragover.prevent="isDragging = true"
                                @dragleave.prevent="isDragging = false"
                                @drop.prevent="handleDrop($event)">
                                
                                <i data-lucide="upload-cloud" class="w-10 h-10 mx-auto text-gray-400 mb-2"></i>
                                <p class="text-gray-600 text-sm">點擊或拖曳圖片至此處上傳</p>
                                <p class="text-gray-400 text-xs mt-1">單檔限制 10MB</p>
                                
                                <input 
                                    ref="imageInput"
                                    type="file" 
                                    accept="image/png,image/jpeg,image/jpg,image/gif,image/webp" 
                                    multiple
                                    @change="handleImageUpload"
                                    class="hidden"
                                />
                            </div>

                            <!-- 已選圖片預覽 -->
                            <div v-if="images.length > 0" class="mt-4">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-sm text-gray-600 flex items-center gap-2">
                                        <i data-lucide="images" class="w-4 h-4"></i>
                                        已選擇 {{ images.length }} 張圖片
                                    </span>
                                    <button 
                                        type="button"
                                        @click="clearAllImages"
                                        class="text-xs text-red-500 hover:text-red-700 flex items-center gap-1 px-2 py-1 rounded hover:bg-red-50 transition-colors">
                                        <i data-lucide="trash-2" class="w-3 h-3"></i>
                                        清除全部
                                    </button>
                                </div>
                                
                                <div class="grid grid-cols-4 gap-3">
                                    <div 
                                        v-for="(img, index) in images" 
                                        :key="index" 
                                        class="relative group aspect-square rounded-lg overflow-hidden border border-gray-200 shadow-sm bg-gray-100">
                                        
                                        <img 
                                            :src="img.url" 
                                            class="w-full h-full object-cover cursor-zoom-in" 
                                            :alt="'預覽圖片 ' + (index + 1)"
                                            @click.stop="openImagePreview(img.url, img.file.name)"
                                        />
                                        <button 
                                            type="button"
                                            @click.stop="removeImage(index)"
                                            class="absolute top-1 right-1 bg-red-500 hover:bg-red-600 
                                                   text-white rounded-full w-6 h-6 flex items-center justify-center
                                                   opacity-0 group-hover:opacity-100 transition-opacity shadow-md">
                                            <i data-lucide="x" class="w-3 h-3"></i>
                                        </button>
                                        
                                        <div class="absolute bottom-0 left-0 bg-black/60 text-white text-xs px-2 py-1 rounded-tr-lg">
                                            {{ index + 1 }}
                                        </div>
                                        
                                        <div class="absolute bottom-0 left-0 right-0 bg-black/70 text-white 
                                                    text-xs p-1.5 truncate opacity-0 group-hover:opacity-100 transition-opacity">
                                            {{ img.file.name }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>




                <!-- 圖片預覽 Lightbox Modal（獨立顯示，不在 v-for 內） -->
                                        <div v-if="showImagePreview" 
                                            class="fixed inset-0 bg-black/90 flex items-center justify-center z-[100]"
                                            @click.self="closeImagePreview">
                                            
                                            <!-- 關閉按鈕 -->
                                            <button 
                                                @click="closeImagePreview"
                                                class="absolute top-4 right-4 text-white hover:text-gray-300 transition-colors z-10 
                                                    bg-black/30 rounded-full p-2 hover:bg-black/50">
                                                <i data-lucide="x" class="w-8 h-8"></i>
                                            </button>
                                            
                                            <!-- 檔案名稱 -->
                                            <div class="absolute top-4 left-4 text-white text-sm bg-black/50 px-4 py-2 rounded-lg flex items-center gap-2">
                                                <i data-lucide="image" class="w-4 h-4"></i>
                                                {{ previewImageName }}
                                            </div>
                                            
                                            <!-- 圖片容器 -->
                                            <div class="relative max-w-[90vw] max-h-[90vh] flex items-center justify-center p-4">
                                                <img 
                                                    :src="previewImageUrl" 
                                                    :alt="previewImageName"
                                                    class="max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl"
                                                    @click.stop
                                                />
                                            </div>
                                            
                                            <!-- 底部提示 -->
                                            <div class="absolute bottom-6 left-1/2 -translate-x-1/2 text-white/50 text-sm flex items-center gap-2">
                                                <i data-lucide="info" class="w-4 h-4"></i>
                                                點擊外部區域或按 ESC 關閉
                                            </div>
                                        </div>


                <!-- Modal Footer -->
                <div class="px-8 py-6 border-t border-gray-100 bg-gray-50 rounded-b-2xl">
                    <div class="flex justify-end items-center gap-3">
                        <button @click="cancelAdd" 
                            class="flex items-center gap-2 px-6 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-medium shadow-sm">
                            <i data-lucide="x" class="w-4 h-4"></i>
                            取消
                        </button>
                        <button 
                            @click="addRecord" 
                            :disabled="isUploading"
                            :class="isUploading 
                                ? 'bg-gray-400 cursor-not-allowed' 
                                : 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700'"
                            class="flex items-center gap-2 px-6 py-2.5 text-white rounded-lg transition-all font-medium shadow-md hover:shadow-lg">
                            <i v-if="isUploading" data-lucide="loader" class="w-4 h-4 animate-spin"></i>
                            <i v-else data-lucide="save" class="w-4 h-4"></i>
                            {{ isUploading ? '上傳中...' : '確認新增' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>



        <!-- 移除確認 Modal -->
        <div v-if="showRejectModal" 
             class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] modal-backdrop">
            <div class="bg-white rounded-2xl shadow-2xl w-[500px] max-h-[70vh] flex flex-col modal-content">
                <div class="px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-red-50 to-red-100 rounded-t-2xl">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold text-gray-800">確認移除</h2>
                        <button @click="cancelReject" class="p-2 hover:bg-white/80 rounded-lg transition-colors">
                            <i data-lucide="x" class="w-4 h-4 text-gray-500"></i>
                        </button>
                    </div>
                </div>
                <div class="flex-1 px-6 py-4">
                    <p class="text-gray-700 mb-4">確定要移除此項目嗎？移除後狀態將變為 Reject。</p>
                </div>
                <div class="px-6 py-4 border-t border-gray-100 bg-gray-50 rounded-b-2xl">
                    <div class="flex justify-end items-center gap-3">
                        <button @click="cancelReject" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">取消</button>
                        <button @click="confirmReject" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg">確認移除</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 復原確認 Modal -->
        <div v-if="showUnrejectModal" 
             class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] modal-backdrop">
            <div class="bg-white rounded-2xl shadow-2xl w-[500px] max-h-[70vh] flex flex-col modal-content">
                <div class="px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-green-50 to-green-100 rounded-t-2xl">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold text-gray-800">確認復原</h2>
                        <button @click="cancelUnreject" class="p-2 hover:bg-white/80 rounded-lg transition-colors">
                            <i data-lucide="x" class="w-4 h-4 text-gray-500"></i>
                        </button>
                    </div>
                </div>
                <div class="flex-1 px-6 py-4">
                    <p class="text-gray-700 mb-4">確定要復原此項目嗎？狀態將變為 New。</p>
                </div>
                <div class="px-6 py-4 border-t border-gray-100 bg-gray-50 rounded-b-2xl">
                    <div class="flex justify-end items-center gap-3">
                        <button @click="cancelUnreject" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">取消</button>
                        <button @click="confirmUnreject" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg">確認復原</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 徹底刪除確認 Modal -->
        <div v-if="showPermanentDeleteModal" 
             class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] modal-backdrop">
            <div class="bg-white rounded-2xl shadow-2xl w-[500px] max-h-[70vh] flex flex-col modal-content">
                <div class="px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-red-50 to-red-100 rounded-t-2xl">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold text-gray-800">徹底刪除</h2>
                        <button @click="cancelPermanentDelete" class="p-2 hover:bg-white/80 rounded-lg transition-colors">
                            <i data-lucide="x" class="w-4 h-4 text-gray-500"></i>
                        </button>
                    </div>
                </div>
                <div class="flex-1 px-6 py-4">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                        <p class="text-red-800 text-sm font-medium">警告：此操作將永久刪除該項目，無法復原！</p>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-100 bg-gray-50 rounded-b-2xl">
                    <div class="flex justify-end items-center gap-3">
                        <button @click="cancelPermanentDelete" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">取消</button>
                        <button @click="confirmPermanentDelete" class="px-4 py-2 bg-red-700 hover:bg-red-800 text-white rounded-lg">確認徹底刪除</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- 浮動按鈕區塊：下載 + 新增 -->
        <div class="fixed bottom-4 right-8 flex items-center gap-4 z-[60]">
            <!-- 下載按鈕 -->
            <button @click="downloadRecords"
                    class="floating-button relative bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-600 
                        hover:from-blue-600 hover:via-blue-700 hover:to-indigo-700 
                        text-white rounded-full w-16 h-16 shadow-xl hover:shadow-2xl hover:shadow-blue-500/25 
                        flex items-center justify-center group transition-all duration-300 
                        hover:scale-105 hover:-translate-y-1 active:scale-95 overflow-hidden">
                <i data-lucide="download" class="w-8 h-8 transition-transform group-hover:scale-110 group-hover:rotate-12 z-10"></i>
                <!-- 內部光暈效果 -->
                <div class="absolute inset-0 rounded-full bg-white/0 group-hover:bg-white/10 transition-all duration-300"></div>
                <!-- 脈動環效果 -->
                <div class="absolute inset-0 rounded-full border-2 border-white/30 opacity-0 group-hover:opacity-100 
                            animate-ping group-hover:animate-pulse"></div>
            </button>

            <!-- 新增按鈕 -->
            <button @click="showAddModal = true"
                    class="floating-button relative bg-gradient-to-br from-green-500 via-emerald-600 to-green-600 
                        hover:from-green-600 hover:via-emerald-700 hover:to-green-700 
                        text-white rounded-full w-16 h-16 shadow-xl hover:shadow-2xl hover:shadow-green-500/25 
                        flex items-center justify-center group transition-all duration-300 
                        hover:scale-105 hover:-translate-y-1 active:scale-95 overflow-hidden">
                <i data-lucide="file-plus-2" class="w-8 h-8 transition-transform group-hover:scale-110 group-hover:rotate-90 z-10"></i>
                <!-- 內部光暈效果 -->
                <div class="absolute inset-0 rounded-full bg-white/0 group-hover:bg-white/10 transition-all duration-300"></div>
                <!-- 脈動環效果 -->
                <div class="absolute inset-0 rounded-full border-2 border-white/30 opacity-0 group-hover:opacity-100 
                            animate-ping group-hover:animate-pulse"></div>
            </button>
        </div>
                
        <!-- 滾動狀態 Toast 彈窗 -->
        <div ref="scrollToast" 
            class="scroll-toast left-toast" 
            :class="{ 'show': showScrollToast }">
            <div class="flex items-center gap-2">
                <div class="relative">
                    <i data-lucide="loader" class="icon"></i>
                    <!-- 添加脈動環效果 -->
                    <div class="absolute inset-0 rounded-full border border-white/30 animate-ping opacity-60"></div>
                </div>
                <div class="flex flex-col">
                    <span class="text-sm font-medium">滾動中...</span>
                    <span class="text-xs opacity-75">{{ Math.round(scrollProgress) }}%</span>
                </div>
            </div>
            <div class="scroll-progress" :style="{ width: scrollProgress + '%' }"></div>
            <!-- 添加背景光暈效果 -->
            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent animate-pulse pointer-events-none rounded-lg"></div>
        </div>

    </div>

    <script src="../static/js/defficultmeeting.js"></script>
</body>
</html>