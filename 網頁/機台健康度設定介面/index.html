<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Machine Config Editor</title>
  <script src="static/js/vue.global.js"></script>
  <script src="static/js/tailwindcss.js"></script>
</head>
<body class="bg-gray-100">
  <div id="app" class="flex">
    <!-- Sidebar -->
    <aside class="w-72 bg-gray-100 border-r border-gray-300 h-screen overflow-y-auto p-4">
      <h2
        class="text-xl font-bold mb-4 text-gray-700 text-center hover:cursor-pointer hover:shadow-md hover:scale-105 transition transform"
        @click="getfirsttable"
      >
        機台健康度設定介面
      </h2>
      <div v-for="building in buildingList" :key="building" class="mb-3">
        <button @click="toggle(building)"
                class="grid grid-cols-[1fr_auto] items-center w-full px-3 py-2 bg-white text-center font-medium text-gray-800 rounded shadow-sm hover:bg-gray-50 transition">
          <span class="justify-self-center w-full">{{ building }}</span>
          <svg :class="{ 'rotate-90': expanded[building] }" class="w-4 h-4 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
        <transition name="fade">
          <ul v-if="expanded[building]" class="mt-2 ml-3 space-y-1">
            <li v-for="floor in floorList[building]" :key="floor">
              <button @click="select(building, floor)"
                      class="w-[75%] ml-4 flex justify-center items-center px-3 py-1.5 rounded hover:bg-blue-100 text-sm text-gray-700 transition text-center">
                {{ floor }}
              </button>
            </li>
          </ul>
        </transition>
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 p-6 bg-white rounded shadow-sm w-full">
      <h2 class="text-2xl font-semibold mb-6 text-gray-800 text-center">機台資料設定</h2>

      <div class="grid grid-cols-5 gap-6 mb-6">
        <div>
          <label class="block mb-1 text-sm font-medium text-gray-700">Plant</label>
          <input type="text" v-model="form.Plant" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring focus:border-blue-400" />
        </div>
        <div>
          <label class="block mb-1 text-sm font-medium text-gray-700">棟別</label>
          <input type="text" v-model="form.SiteBuilding" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring focus:border-blue-400" />
        </div>
        <div>
          <label class="block mb-1 text-sm font-medium text-gray-700">樓層</label>
          <input type="text" v-model="form.SiteFloor" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring focus:border-blue-400" />
        </div>
        <div>
          <label class="block mb-1 text-sm font-medium text-gray-700">IP</label>
          <input type="text" v-model="form.IP" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring focus:border-blue-400" />
        </div>
        <div>
          <label class="block mb-1 text-sm font-medium text-gray-700">MachineID</label>
          <input type="text" v-model="form.MachineID" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring focus:border-blue-400" />
        </div>
      </div>

      <div class="grid grid-cols-4 gap-4 mb-6">
        <div>
          <label class="block mb-1 text-sm font-medium text-gray-700">RED</label>
          <input type="number" v-model="form.DI_Map.RED" min="0" max="11" class="w-full px-2 py-1 border border-gray-300 rounded" />
        </div>
        <div>
          <label class="block mb-1 text-sm font-medium text-gray-700">YELLOW</label>
          <input type="number" v-model="form.DI_Map.YELLOW" min="0" max="11" class="w-full px-2 py-1 border border-gray-300 rounded" />
        </div>
        <div>
          <label class="block mb-1 text-sm font-medium text-gray-700">GREEN</label>
          <input type="number" v-model="form.DI_Map.GREEN" min="0" max="11" class="w-full px-2 py-1 border border-gray-300 rounded" />
        </div>
        <div>
          <label class="block mb-1 text-sm font-medium text-gray-700">BLUE</label>
          <input type="number" v-model="form.DI_Map.BLUE" min="0" max="11" class="w-full px-2 py-1 border border-gray-300 rounded" />
        </div>
      </div>

      <div class="flex gap-4 justify-center mt-4">
        <button @click="clearForm"
                class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition">
          清空
        </button>
        <button @click="addMachine"
                class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition">
          新增
        </button>
      </div>

      <div class="mt-10">
        <h3 class="text-xl font-semibold mb-4 text-gray-700 text-center">機台資料列表</h3>
        <div class="overflow-auto max-h-[calc(100vh-320px)] border rounded shadow-sm">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100 sticky top-0 z-10">
              <tr>
                <th class="px-5 py-2 text-sm font-semibold text-gray-700 text-center">置入時間</th>
                <th class="px-5 py-2 text-sm font-semibold text-gray-700 text-center">Plant</th>
                <th class="px-5 py-2 text-sm font-semibold text-gray-700 text-center">棟別</th>
                <th class="px-5 py-2 text-sm font-semibold text-gray-700 text-center">樓層</th>
                <th class="px-5 py-2 text-sm font-semibold text-gray-700 text-center">IP</th>
                <th class="px-5 py-2 text-sm font-semibold text-gray-700 text-center">MachineID</th>
                <th class="px-5 py-2 text-sm font-semibold text-gray-700 text-center">DI Map</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-100">
              <tr v-for="(item, i) in machineList" :key="i">
                <td class="px-4 py-2 text-sm text-gray-700 text-center">{{ item.TIME }}</td>
                <td class="px-4 py-2 text-sm text-gray-700 text-center">{{ item.Plant }}</td>
                <td class="px-4 py-2 text-sm text-gray-700 text-center">{{ item.Site.split('-')[0] }}</td>
                <td class="px-4 py-2 text-sm text-gray-700 text-center">{{ item.Site.split('-')[1] }}</td>
                <td class="px-4 py-2 text-sm text-gray-700 text-center">{{ item.IP }}</td>
                <td class="px-4 py-2 text-sm text-gray-700 text-center">{{ item.MachineID }}</td>
                <td class="px-4 py-2 text-sm text-gray-700 text-center flex justify-center gap-2">
                  <span class="bg-red-100 text-red-700 px-2 py-0.5 rounded text-xs">RED: {{ item.DI_Map?.RED }}</span>
                  <span class="bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded text-xs">YELLOW: {{ item.DI_Map?.YELLOW }}</span>
                  <span class="bg-green-100 text-green-700 px-2 py-0.5 rounded text-xs">GREEN: {{ item.DI_Map?.GREEN }}</span>
                  <span class="bg-blue-100 text-blue-700 px-2 py-0.5 rounded text-xs">BLUE: {{ item.DI_Map?.BLUE }}</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <script src="static/js/app.js"></script>
  <style>
    .fade-enter-active,
    .fade-leave-active {
      transition: all 0.3s ease;
    }
    .fade-enter-from,
    .fade-leave-to {
      opacity: 0;
      transform: translateY(-4px);
    }
  </style>
</body>
</html>
